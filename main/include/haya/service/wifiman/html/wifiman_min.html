<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Haya WiFi Manager</title><style> :root { --bg-core: #0a0a0a; --bg-panel: #141414; --text-main: #e0e0e0; --text-muted: #757575; --accent: #ff5252; --accent-dim: #b71c1c; --border: #333; --status-green: #00e676; --status-red: #ff1744; } * { box-sizing: border-box; border-radius: 0 !important; } body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-core); color: var(--text-main); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; } .app-container { width: 100%; max-width: 450px; display: flex; flex-direction: column; gap: 20px; } header { text-align: center; border-bottom: 2px solid var(--accent); padding-bottom: 15px; margin-bottom: 10px; } h1 { margin: 0; font-weight: 300; font-size: 1.8rem; letter-spacing: 1px; color: var(--text-main); text-transform: uppercase; } .status-panel { background: var(--bg-panel); border: 1px solid var(--border); padding: 15px; display: grid; grid-template-columns: 1fr 2fr; gap: 10px; font-size: 0.9rem; } .status-label { color: var(--text-muted); text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; } .status-value { text-align: right; font-family: monospace; font-size: 1rem;} .indicator { display: inline-block; width: 10px; height: 10px; background-color: var(--status-red); margin-right: 8px; box-shadow: 0 0 5px var(--status-red); transition: background-color 0.3s, box-shadow 0.3s; } .indicator.connected { background-color: var(--status-green); box-shadow: 0 0 8px var(--status-green); } .list-panel { background: var(--bg-panel); border: 1px solid var(--border); padding: 0; } .table-container { max-height: 250px; overflow-y: auto; } table { width: 100%; border-collapse: collapse; } th { background: #1a1a1a; color: var(--accent); text-align: left; padding: 10px; font-size: 0.8rem; text-transform: uppercase; border-bottom: 1px solid var(--accent); } td { padding: 12px 10px; border-bottom: 1px solid var(--border); font-size: 0.9rem; } tr:last-child td { border-bottom: none; } tr.clickable:hover { background: #252525; cursor: pointer; color: var(--accent); } .input-group { margin-bottom: 15px; } label { display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 0.8rem; } input { width: 100%; padding: 12px; background: #000; border: 1px solid var(--border); color: white; font-size: 1rem; transition: border-color 0.3s; } input:focus { outline: none; border-color: var(--accent); } button { width: 100%; padding: 14px; background: transparent; border: 1px solid var(--accent); color: var(--accent); font-size: 0.9rem; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; cursor: pointer; transition: all 0.2s; margin-bottom: 10px; } button:hover:not(:disabled) { background: var(--accent); color: #000; } button:disabled { border-color: #333; color: #555; cursor: not-allowed; } #btnScan { margin: 0; border: none; border-bottom: 1px solid var(--border); color: var(--text-muted); font-size: 0.8rem; padding: 10px;} #btnScan:hover { background: #222; color: var(--text-main); } #btnCommit { margin-top: 10px; border-color: var(--status-green); color: var(--status-green); } #btnCommit:hover:not(:disabled) { background: var(--status-green); color: #000; } .text-center { text-align: center; padding: 20px; color: var(--text-muted); } </style></head><body><div class="app-container"><header><h1>Haya Wifi Manager</h1></header><section class="status-panel"><div class="status-label">Status</div><div class="status-value"><span id="ledStatus" class="indicator"></span><span id="txtStatus">Disconnected</span></div><div class="status-label">SSID</div><div class="status-value" id="txtSSID">-</div><div class="status-label">IP Address</div><div class="status-value" id="txtIP">0.0.0.0</div></section><section class="list-panel"><button id="btnScan" onclick="startScan()">SCAN NETWORKS</button><div class="table-container"><table id="wifiTable"><thead><tr><th width="60%">SSID</th><th width="20%">RSSI</th><th width="20%">Lock</th></tr></thead><tbody id="wifiListBody"><tr><td colspan="3" class="text-center">No data. Click Scan.</td></tr></tbody></table></div></section><section><div class="input-group"><label>TARGET SSID</label><input type="text" id="inpSSID" placeholder="Select or type..."></div><div class="input-group"><label>PASSWORD</label><input type="password" id="inpPass" placeholder="Enter password..."></div></section><section><button id="btnConnect" onclick="doConnect()">Connect</button><button id="btnCommit" onclick="doCommit()" disabled>Commit & Close</button></section></div><script> const $ = (id) => document.getElementById(id); let isConnected = false; let isNegotiating = false; const REASON_MAP = { 201: "AP Not Found", 202: "Auth Failed", 15: "Wrong Password", 200: "Beacon Timeout", 204: "Handshake Timeout", 2: "Auth Expired", 203: "Assoc Failed" }; function updateStatus() { if (isNegotiating) return; fetch('/wifiman/api/status') .then(res => res.json()) .then(data => { const led = $('ledStatus'); const txtStat = $('txtStatus'); const txtSSID = $('txtSSID'); const txtIP = $('txtIP'); const btnCommit = $('btnCommit'); isConnected = data.connected; if (isConnected) { led.classList.add('connected'); txtStat.innerText = "Connected"; txtSSID.innerText = data.ssid; txtIP.innerText = data.ip; btnCommit.disabled = false; } else { led.classList.remove('connected'); if(txtStat.innerText !== "Connecting...") { txtStat.innerText = "Disconnected"; } txtSSID.innerText = "-"; txtIP.innerText = "0.0.0.0"; btnCommit.disabled = true; } }) .catch(e => console.log("Status poll failed")); } setInterval(updateStatus, 1500); function startScan() { const btn = $('btnScan'); const tbody = $('wifiListBody'); btn.innerText = "SCANNING..."; btn.disabled = true; tbody.innerHTML = "<tr><td colspan='3' class='text-center'>Scanning...</td></tr>"; fetch('/wifiman/api/scan', { method: 'POST' }) .then(res => { if (res.ok || res.status === 409) { setTimeout(fetchScanned, 2000); } else { throw new Error("Scan start failed"); } }) .catch(e => { btn.innerText = "SCAN NETWORKS"; btn.disabled = false; tbody.innerHTML = "<tr><td colspan='3' class='text-center'>Error starting scan</td></tr>"; }); } function fetchScanned() { fetch('/wifiman/api/scanned') .then(res => { if (res.status === 409) { setTimeout(fetchScanned, 1000); } else return res.json(); }) .then(data => { if(data) renderTable(data); }) .catch(e => { $('btnScan').innerText = "SCAN NETWORKS"; $('btnScan').disabled = false; }); } function renderTable(data) { const tbody = $('wifiListBody'); tbody.innerHTML = ""; $('btnScan').innerText = "SCAN NETWORKS"; $('btnScan').disabled = false; if (data.length === 0) { tbody.innerHTML = "<tr><td colspan='3' class='text-center'>No AP Found</td></tr>"; return; } data.sort((a, b) => b.rssi - a.rssi); data.forEach(ap => { let row = document.createElement('tr'); row.className = "clickable"; row.onclick = () => { $('inpSSID').value = ap.ssid; $('inpPass').focus(); }; row.innerHTML = ` <td>${ap.ssid}</td><td>${ap.rssi}</td><td>${ap.auth === 0 ? 'Open' : 'Lock'}</td> `; tbody.appendChild(row); }); } function doConnect() { const ssid = $('inpSSID').value; const pass = $('inpPass').value; const btn = $('btnConnect'); if (!ssid) return alert("SSID required"); isNegotiating = true; btn.disabled = true; $('txtStatus').innerText = "Connecting..."; fetch('/wifiman/api/connect', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ ssid: ssid, password: pass }) }) .then(res => { if (res.ok) { setTimeout(pollConnectionResult, 1000); } else { throw new Error("Failed to send credentials"); } }) .catch(e => { alert(e.message); resetConnectUI(); }); } function pollConnectionResult() { fetch('/wifiman/api/connsts') .then(res => res.json()) .then(data => { if (!data.done) { setTimeout(pollConnectionResult, 1000); } else { isNegotiating = false; if (data.success) { $('btnConnect').disabled = false; } else { let errorMsg = REASON_MAP[data.reason] || ("Error Code: " + data.reason); alert("Connection Failed: " + errorMsg); resetConnectUI(); } } }) .catch(e => { console.log("Connsts poll failed, retrying..."); setTimeout(pollConnectionResult, 1500); }); } function resetConnectUI() { isNegotiating = false; $('btnConnect').disabled = false; $('txtStatus').innerText = "Disconnected"; } function doCommit() { if(!confirm("Commit this WiFi and close the AP?")) return; const btn = $('btnCommit'); btn.innerText = "SAVING..."; btn.disabled = true; fetch('/wifiman/api/commit', { method: 'POST' }) .then(res => { if(res.ok) { alert("Committed successfully, this AP will be closed soon."); location.reload(); } else { alert("Commit failed. You may continue to configure the WiFi."); btn.innerText = "Commit & Close"; btn.disabled = false; } }); } updateStatus();</script></body></html>